<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secure Checkout - Styler</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <script type="text/javascript" src="//cdn.evgnet.com/beacon/a556rq555550mxe43n3n3n091568480/styler/scripts/evergage.min.js"></script>
  <script src="api-config.js"></script>
</head>
<body>
  <div id="header-placeholder"></div>

  <div class="checkout-steps">
    <div class="checkout-step active"><div class="checkout-step-circle">1</div>Basket</div>
    <div class="checkout-step active"><div class="checkout-step-circle">2</div>Secure Checkout</div>
    <div class="checkout-step"><div class="checkout-step-circle">3</div>Complete</div>
  </div>

  <div class="checkout-main">
    <div class="checkout-left">
      <div class="address-summary" id="addressSummary">
        <h3>Delivery Address <span class="edit-link" onclick="showAddressForm()">Edit</span></h3>
        <div id="addressDisplay"></div>
        <form id="addressForm" style="display:none; margin-top:16px;">
          <label>Full Name: <input type="text" id="fullName" required></label>
          <label>Phone: <input type="tel" id="phone" required></label>
          <label>Address: <input type="text" id="address" required></label>
          <label>City: <input type="text" id="city" required></label>
          <label>State: <input type="text" id="state" required></label>
          <label>Pincode: <input type="text" id="pincode" required></label>
          <button type="submit" class="checkout-btn">Save Address</button>
        </form>
      </div>

      <div class="shipping-options">
        <h3>Shipping Services</h3>
        <label><input type="radio" name="shipping" value="standard" checked> Standard Delivery - <span id="standardDeliveryDate"></span> ₹59</label>
        <label><input type="radio" name="shipping" value="express"> Express Delivery - <span id="expressDeliveryDate"></span> ₹129</label>
      </div>

      <div class="payment-methods">
        <h3>Secure Payment</h3>
        <label><input type="radio" name="payment" value="card" checked> Credit / Debit Card 
          <img src="https://img.icons8.com/color/32/000000/visa.png" style="vertical-align:middle;"> 
          <img src="https://img.icons8.com/color/32/000000/mastercard.png" style="vertical-align:middle;">
        </label>
        <label><input type="radio" name="payment" value="paypal"> PayPal 
          <img src="https://img.icons8.com/color/32/000000/paypal.png" style="vertical-align:middle;">
        </label>
        <label><input type="radio" name="payment" value="cod"> Cash on Delivery</label>
      </div>

      <button class="checkout-btn" onclick="placeOrder()">Confirm & Pay</button>
    </div>

    <div class="checkout-right">
      <div class="order-summary">
        <h3>Summary</h3>
        <div id="checkoutProductDisplay"></div>
        <div id="orderItems"></div>
        <div class="order-total-row">Total To Pay: <span id="orderTotal"></span></div>
        <div style="margin-top:8px; color:#28a745; font-size:0.95rem;" id="freeDeliveryMsg"></div>
      </div>
    </div>
  </div>

  <script src="cart-manager.js"></script>
  <script src="header.js"></script>
  <script src="footer.js"></script>
  <script src="checkout.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      
      const mcpItems = cart.map((item, idx) => ({
        index: String(idx),
        item_id: String(item.id),
        item_name: item.name,
        price: String(item.price),
        quantity: String(item.quantity),
        color: item.color || '',
        size: item.size || '',
        imageUrl: item.image || '',
        url: item.url || window.location.origin
      }));

      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({
        event: 'MCP',
        MCP: {
          currency: 'GBP', // Change as per your store
          pageType: 'view_checkout',
          pageName: 'Checkout page',
          items: mcpItems
        }
      });

      console.log("Checkout MCP datalayer initialized:", window.dataLayer);
    });
  </script>
</body>
</html>
